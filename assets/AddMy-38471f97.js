import{u as w,p as _,r as v,o as x,a as O,b as g,d as f,e,i as T,t as q,q as A,s as d,v as i,h as G}from"./index-42588570.js";import{_ as N}from"./_plugin-vue_export-helper-c27b6911.js";const M={class:"add-task"},V={key:0,class:"confirm-dialog"},J={class:"form-group"},U={class:"form-group"},B={class:"form-group"},C={class:"form-group"},E={__name:"AddMy",setup(R){const c=w(),r=_(),a=v({title:"",description:"",deadline:"",startDate:new Date().toISOString().split("T")[0],id:Date.now(),type:"task"}),u=v(!1);x(()=>{if(r.query.mode==="edit"){const o=localStorage.getItem("editingGoal");if(o){const t=JSON.parse(o);a.value={...t,startDate:t.startDate.split("T")[0],deadline:t.deadline.split("T")[0]}}}}),O(()=>{localStorage.removeItem("editingGoal")});const D=()=>{const o=localStorage.getItem("goals");return o?JSON.parse(o):[]},y=o=>{localStorage.setItem("goals",JSON.stringify(o))},S=()=>{const o=new Date(a.value.startDate),t=new Date(a.value.deadline);if(o>t){u.value=!0;return}const s=D();if(r.query.mode==="edit"){const l=s.findIndex(p=>p.id===a.value.id);if(l!==-1){s[l]={...s[l],...a.value,updatedAt:new Date().toISOString()};const p=localStorage.getItem("myDaysItems")||"[]";let n=JSON.parse(p);const m=n.findIndex(I=>I.id===a.value.id);m!==-1&&(n[m]={...n[m],...a.value,updatedAt:new Date().toISOString()},localStorage.setItem("myDaysItems",JSON.stringify(n)))}}else{const l={...a.value,id:Date.now(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),progress:0};s.push(l)}y(s),c.back()},k=()=>{c.back()},b=()=>{u.value=!1};return(o,t)=>(g(),f("div",M,[u.value?(g(),f("div",V,[e("div",{class:"dialog-content"},[t[4]||(t[4]=e("p",null,"开始时间不能晚于截止时间",-1)),e("div",{class:"dialog-buttons"},[e("button",{onClick:b,class:"btn-confirm"},"确定")])])])):T("",!0),e("h2",null,q(A(r).query.mode==="edit"?"编辑任务":"新建任务"),1),e("form",{onSubmit:G(S,["prevent"])},[e("div",J,[t[5]||(t[5]=e("label",{for:"taskTitle"},"任务名称",-1)),d(e("input",{type:"text",id:"taskTitle","onUpdate:modelValue":t[0]||(t[0]=s=>a.value.title=s),required:"",placeholder:"请输入任务名称"},null,512),[[i,a.value.title]])]),e("div",U,[t[6]||(t[6]=e("label",{for:"taskDesc"},"任务描述",-1)),d(e("textarea",{id:"taskDesc","onUpdate:modelValue":t[1]||(t[1]=s=>a.value.description=s),placeholder:"请输入任务描述（选填）",rows:"3"},null,512),[[i,a.value.description]])]),e("div",B,[t[7]||(t[7]=e("label",{for:"taskDeadline"},"截止日期",-1)),d(e("input",{type:"date",id:"taskDeadline","onUpdate:modelValue":t[2]||(t[2]=s=>a.value.deadline=s),required:""},null,512),[[i,a.value.deadline]])]),e("div",C,[t[8]||(t[8]=e("label",{for:"taskStartDate"},"开始日期",-1)),d(e("input",{type:"date",id:"taskStartDate","onUpdate:modelValue":t[3]||(t[3]=s=>a.value.startDate=s),required:""},null,512),[[i,a.value.startDate]])]),e("div",{class:"form-actions"},[e("button",{type:"button",class:"btn-cancel",onClick:k},"取消"),t[9]||(t[9]=e("button",{type:"submit",class:"btn-submit"},"保存",-1))])],32)]))}},z=N(E,[["__scopeId","data-v-3d707411"]]);export{z as default};
